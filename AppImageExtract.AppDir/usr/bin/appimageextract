#!/usr/bin/env python2

import os, sys

if len(sys.argv) > 1:
    selection = sys.argv[1]
else:
    from gi.repository import Gtk
    dialog = Gtk.FileChooserDialog("Pick a file", None,
                                            Gtk.FileChooserAction.OPEN,
                                           (Gtk.STOCK_CANCEL, Gtk.ResponseType.CANCEL,
                                            Gtk.STOCK_OPEN, Gtk.ResponseType.OK))
    dialog.set_current_folder(os.path.expanduser("~/Desktop/"))
    response = dialog.run()
    selection = dialog.get_filename()
    dialog.destroy()
    if not response == Gtk.ResponseType.OK:
        exit(0)

print(selection + ' selected')
name = os.path.basename(selection)
appdir = os.path.expanduser("~/Desktop/" + name + ".AppDir")
os.system("mkdir -p ~/Desktop/")
command = 'xorriso -indev "' + selection + '" -osirrox on -extract / "' + appdir + '"'
print(command)
os.system(command)
os.system('sudo chown -R "${USER}" "' + appdir + '"')
